
Upgrade instructions to ikaaro 0.20.0
**********************************************************************

For System Administrators
=========================

(1) The signature of the "icms-start.py" script has changed concerning
the way to detach, or not, from the console:

                  Before                    Now
                  -----------------------   -----------------------
  (don't detach)  icms-start.py -d <path>   icms-start.py <path>
  (detach)        icms-start.py <path>      icms-start.py -d <path>

Type "icms-start.py --help" to learn the details of the new signature.

(2) The log files have been moved to the new "log" directory:

  Before            Now
  ---------------   -------------------
  access_log        log/access
  error_log         log/error
  spool_log         log/spool
  spool_error_log   log/spool_error

(3) It is higly recommended to define the new "contact-email" variable
of the configuration file.


Update the database
-------------------

As usual instances must be updated following the standard procedure:

  1. Make a backup

  2. Update the database:

     $ icms-update.py xxx

  3. Rebuild the catalog:

     $ icms-update-catalog.py xxx

But there are some important changes concerning the second step.  Now
the "icms-update.py" script writes a log detailing the objects that
failed to upgrade, if any.  This log is named "log/update".

If some objects fail to upgrade, check the update log file and try to
resolve the problems, then run again the "icms-update.py" script.

If you don't know how to resolve a problem, ask to the mailing list.



For developers
==============



1. Imports
----------

Most important, "itools.cms" has been changed to "ikaaro":

  from itools.cms import XXX                     # Before
  from ikaaro import XXX                         # Now

The module "future" has become a package:

  from itools.cms.future import Dressable        # Before
  from ikaaro.future.dressable import Dressable  # Now

  from itools.cms.future import OrderAware       # Before
  from ikaaro.future.order import OrderAware     # Now

Other renames include:

  from itools.cms.html import XHTMLFile          # Before
  from ikaaro.html import WebPage                # Now


2. 
------------------




UNCLASSIFIED
============

Remove obsolete code (ListOfUsers)
_get_virtual_handler => _get_object

"get_real_handler" => "get_real_object"
"get_physical_path" => "get_canonical_path"

Code reorganization: wiki, tracker, future, forum

"search_handlers" => "search_objects"

It is not necessary to inherit from ikaaro.Root class to define the catalog fields now.

Remove "get_pathtoroot"

send_email prototype
"new_instance*" are now staticmethod, drop the last traces of "im_func"
Remove the "owner" metadata.






New metadata architecture
Decentralize "icms-update.py"


Proof-of-concept interface to check broken links.
Add a log file to "icms-update.py"
Now files "remember" the original filename.
Unify HTML and XHTML web pages
Move the contact email to the configuration file.
Remove "icms-make-package.py"

Replace "change_language" by a more efficient (no redirections), robust (no
referrer) and google friendly way to set the language.

Fix upload of multilingual files.  Add optional "title" to the upload form.
extend the wiki/tracker action box to all containers
Allow to use an smtp that required identification
Remove plain text files from the add form.
changes to the icms-start.py signature
new option DEBUG
new folder "log"
"new_instance*" are now staticmethod, drop the last traces of "im_func"
Allow to send html emails with send_email method

Move the contact email to the configuration file.
